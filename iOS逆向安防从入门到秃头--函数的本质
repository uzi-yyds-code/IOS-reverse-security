*   å…„å¼Ÿä»¬ï¼Œå°è°·åˆæ˜¯å‹¤å¥‹çš„ä¸€å¤©~~

*   ä»Šå¤©å’Œå…„å¼Ÿä»¬ä¸€èµ·ï¼Œè¿‘è·ç¦»è§‚å¯Ÿä¸‹ï¼Œ`å‡½æ•°ä¹‹ç¾`~

*   æˆ‘ä¹Ÿå°±ç›´æ¥æ­¥å…¥æ­£é¢˜äº†~

## 1\. å‡½æ•°çš„å‚æ•°

*   å…„å¼Ÿä»¬æ™®ééƒ½å¬è¯´è¿‡ï¼š`å‡½æ•°`çš„`å‚æ•°`æœ€å¥½ä¸è¦è¶…è¿‡`8`ä¸ªï¼Œ`OCæ–¹æ³•`çš„è°ƒç”¨ä¸è¦è¶…è¿‡`6`ä¸ª

*   å› ä¸º`OCæ–¹æ³•`æœ‰`2`ä¸ª`éšè—å‚æ•°ï¼ˆid self, SEL _cmdï¼‰`ï¼Œæ‰€ä»¥å…¶å®ä¹Ÿæ˜¯`8`ä¸ªï¼Œé‚£ä¹ˆ`8`ä¸ªæ˜¯æ€ä¹ˆæ¥çš„å‘¢?

*   æ¥ä¸‹æ¥ï¼Œå…„å¼Ÿä»¬ä¸€æ¢ç©¶ç«Ÿ~

> æˆ‘ä»¬å…ˆå‡è®¾ï¼Œä¼ å…¥å‚æ•°ä¸º`9`ä¸ªï¼Œçœ‹çœ‹`æ±‡ç¼–`æ˜¯æ€ä¹ˆæ“ä½œçš„ï¼ˆè¿™é‡Œæ±‡ç¼–`ä¸èƒ½`ç”¨`release`ç‰ˆï¼Œå¦åˆ™`LLVM`éƒ½ä¼šä¼˜åŒ–æ‰ï¼‰

*   ä¸Šä»£ç ï¼š

```
void parameterText(int a,int b,int c,int d,int e,int f,int g,int h,int i){

    printf("%d",a+b+c+d+e+f+g+h+i);

}
int main(int argc, char * argv[]) {
    parameterText(1,2,3,4,5,6,7,8,9);
}
å¤åˆ¶ä»£ç 
```

> æˆ‘ä»¬æ–­ç‚¹çœ‹`æ±‡ç¼–`

> å°è°·éå¸¸è´´å¿ƒçš„å†™å¥½äº†æ³¨é‡Š~

*   mian æ–¹æ³•

![1.png](https://upload-images.jianshu.io/upload_images/19704571-e7fc549628db29d2.image?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

*   parameterTextå‡½æ•°

![2.png](https://upload-images.jianshu.io/upload_images/19704571-10f8260443d668b1.image?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

**æˆ‘ä»¬é€šè¿‡`æ±‡ç¼–`å¯ä»¥çœ‹å‡ºï¼Œ`x0-x7`å­˜å‚æ•°ï¼Œè¶…è¿‡ä¹‹åå°±ä¼šå…¥æ ˆï¼Œç­‰å¾…ç”¨çš„æ—¶å€™ï¼Œä¼šåœ¨è°ƒç”¨çš„å‡½æ•°ä¸­`åç§»å–å€¼ã€åœ¨å­˜å€¼ã€åœ¨å–å€¼ã€åœ¨ç›¸åŠ `**

> æ‰€ä»¥ï¼Œå‚æ•°ä¸è¶…è¿‡8ä¸ªæ˜¯æœ‰åŸå› çš„~~ (`x0-x7`å­˜å‚æ•°)

## 2\. å‡½æ•°çš„è¿”å›å€¼

*   æˆ‘ä»¬ä»”ç»†åˆ†æäº†å‡½æ•°çš„`å‚æ•°`ï¼Œä¸‹é¢æˆ‘ä»¬ç ”ç©¶ä¸‹`å‡½æ•°çš„è¿”å›å€¼`ã€‚ä¼šä¸ä¼šæœ‰ä»€ä¹ˆæƒŠå–œ~

### 2.1\. æ™®é€šè¿”å›å€¼

*   æ™®é€šæƒ…å†µä¸‹æˆ‘ä»¬åªä¼šè¿”å›ä¸€ä¸ªå€¼ã€‚æˆ‘ä»¬ç ”ç©¶ä¸‹ï¼Œä»–æ˜¯æ€ä¹ˆå­˜å‚¨çš„ã€æ€ä¹ˆè·å–çš„~

*   æ¥ä¸ªç®€å•çš„åŠ æ³•å§

```
int sumTest(int a, int b){
    return a+b;
}
int main(int argc, char * argv[]) {
    int c = sumTest(10,20);
    printf("%d\n",c);
}
å¤åˆ¶ä»£ç 
```

> è€è§„çŸ©ï¼Œå…„å¼Ÿä»¬ï¼Œæ–­ç‚¹çœ‹æ±‡ç¼–~

*   mainæ–¹æ³•æ±‡ç¼–~(å°è°·å–œæ¬¢ç´«è‰²å’Œè“è‰²~)

![3.png](https://upload-images.jianshu.io/upload_images/19704571-e4b72648054b9610.image?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

*   sumTestæ–¹æ³•æ±‡ç¼–

![4.png](https://upload-images.jianshu.io/upload_images/19704571-cd3685474247446d.image?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

> ä¸Šé¢åˆ†ææ±‡ç¼–æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥â€” è¿”å›å€¼å­˜æ”¾åœ¨`w0`ä¸­ï¼ˆå› ä¸ºè¿™ä¸ªå€¼éœ€è¦4ä½ï¼Œè¦æ˜¯8ä½åº”è¯¥å°±æ˜¯`X0`ä¸­ï¼Œè¿™ä¸ªå¤§å®¶å¯ä»¥è‡ªå·±è¯•éªŒä¸‹~ ï¼‰(æ¯•ç«Ÿ`w0`æ˜¯`x0`çš„åä½ä½)

### 2.2\. ç»“æ„ä½“è¿”å›å€¼

> æ¥ç‚¹åˆºæ¿€çš„~

*   æˆ‘ä»¬åˆšåˆšåˆ†æäº†æ™®é€šçš„è¿”å›å€¼ã€‚é‚£æˆ‘å°±æ¯”è¾ƒå¥½å¥‡è¦æ˜¯`ç»“æ„ä½“`ï¼Œè¿™ç§æ¯”è¾ƒç‰¹æ®Šçš„å‘¢ï¼Ÿ

*   è€Œä¸”ï¼Œæˆ‘çªç„¶æƒ³åˆ°äº†ä¸€ä¸ªäº‹æƒ…ã€‚ç»“æ„ä½“çš„å‚æ•°è¦æ˜¯`å¤§äº8ä½`ä¼šæ€ä¹ˆæ ·ï¼Ÿï¼Œè¯¶~ï¼Œæä¸€æ³¢æä¸€æ³¢ã€‚æˆ‘è¿™æ— å¤„å®‰æ”¾çš„æ±‚çŸ¥æ¬²

*   ä»£ç èµ°èµ·~

```
struct XGSTRUCT {
    int a;
    int b;
    int c;
    int d;
    int e;
    int f;
    int g;
    int h;
    int i;
};

struct XGSTRUCT getStruct(int a,int b,int c,int d,int e,int f,int g,int h,int i){
    struct XGSTRUCT xgStr;
    xgStr.a = a;
    xgStr.b = b;
    xgStr.c = c;
    xgStr.d = d;
    xgStr.e = e;
    xgStr.f = f;
    xgStr.g = g;
    xgStr.h = h;
    xgStr.i = i;
    return xgStr;
}

int main(int argc, char * argv[]) {
    struct XGSTRUCT xg_str = getStruct(1,2,3,4,5,6,7,8,9);
    printf("%d\n%d\n%d\n%d\n%d\n%d\n%d\n%d\n%d\n",xg_str.a,xg_str.b,xg_str.c,xg_str.d,xg_str.e,xg_str.f,xg_str.g,xg_str.h,xg_str.i);
}
å¤åˆ¶ä»£ç 
```

*   çœ‹`æ±‡ç¼–ä»£ç `å–½~

> `mianå‡½æ•°`å®åœ¨æ˜¯å¤ªé•¿äº†~ï¼ˆä¸èƒ½æˆªå›¾åˆ†æäº†~ï¼‰ï¼ˆæˆ‘æŠŠå…³é”®çš„æ ‡å¥½æ³¨é‡Šäº†~ï¼‰

```
StackFuncDemo`main:
    0x102a8216c <+0>:   sub    sp, sp, #0xa0             ; =0xa0 
    0x102a82170 <+4>:   stp    x20, x19, [sp, #0x80]
    0x102a82174 <+8>:   stp    x29, x30, [sp, #0x90]
    0x102a82178 <+12>:  add    x29, sp, #0x90            ; =0x90 
    0x102a8217c <+16>:  stur   w0, [x29, #-0x14]
    0x102a82180 <+20>:  stur   x1, [x29, #-0x20]
    0x102a82184 <+24>:  sub    x8, x29, #0x44            ; =0x44 æŠŠx8æŒ‡å‘ x29(æ ˆåº•)åç§» 0x44ï¼ˆè¿™å°±ç›¸å½“äºé¢„ç•™äº†ä¸€æ®µç©ºé—´ï¼‰
    0x102a82188 <+28>:  mov    w0, #0x1
    0x102a8218c <+32>:  mov    w1, #0x2
    0x102a82190 <+36>:  mov    w2, #0x3
    0x102a82194 <+40>:  mov    w3, #0x4
    0x102a82198 <+44>:  mov    w4, #0x5
    0x102a8219c <+48>:  mov    w5, #0x6
    0x102a821a0 <+52>:  mov    w6, #0x7
    0x102a821a4 <+56>:  mov    w7, #0x8
->  0x102a821a8 <+60>:  mov    x9, sp                   ;æŠŠx9æŒ‡å‘sp(å½“å‰å‡½æ•°çš„æ ˆé¡¶)
    0x102a821ac <+64>:  mov    w10, #0x9                ;æŠŠ#0x9å­˜å…¥w10
    0x102a821b0 <+68>:  str    w10, [x9]                ;æŠŠw10å­˜åœ¨x9(å½“å‰å‡½æ•°çš„æ ˆé¡¶)çš„é«˜åœ°å€
    0x102a821b4 <+72>:  bl     0x102a820f0              ; getStruct at main.m:46
    0x102a821b8 <+76>:  ldur   w10, [x29, #-0x44]       ;ä¸‹é¢çš„å–å€¼æ“ä½œå°±æ˜¯å½“æ—¶é¢„ç•™çš„åœ°å€
    0x102a821bc <+80>:  mov    x8, x10
    0x102a821c0 <+84>:  ldur   w10, [x29, #-0x40]
    0x102a821c4 <+88>:  mov    x9, x10
    0x102a821c8 <+92>:  ldur   w10, [x29, #-0x3c]
    0x102a821cc <+96>:  mov    x11, x10
    0x102a821d0 <+100>: ldur   w10, [x29, #-0x38]
    0x102a821d4 <+104>: mov    x12, x10
    0x102a821d8 <+108>: ldur   w10, [x29, #-0x34]
    0x102a821dc <+112>: mov    x13, x10
    0x102a821e0 <+116>: ldur   w10, [x29, #-0x30]
    0x102a821e4 <+120>: mov    x14, x10
    0x102a821e8 <+124>: ldur   w10, [x29, #-0x2c]
    0x102a821ec <+128>: mov    x15, x10
    0x102a821f0 <+132>: ldur   w10, [x29, #-0x28]
    0x102a821f4 <+136>: mov    x16, x10
    0x102a821f8 <+140>: ldur   w10, [x29, #-0x24]
    0x102a821fc <+144>: mov    x17, x10
    0x102a82200 <+148>: adrp   x0, 1
    0x102a82204 <+152>: add    x0, x0, #0xf48            ; =0xf48 
    0x102a82208 <+156>: mov    x19, sp
    0x102a8220c <+160>: str    x8, [x19]
    0x102a82210 <+164>: str    x9, [x19, #0x8]
    0x102a82214 <+168>: str    x11, [x19, #0x10]
    0x102a82218 <+172>: str    x12, [x19, #0x18]
    0x102a8221c <+176>: str    x13, [x19, #0x20]
    0x102a82220 <+180>: str    x14, [x19, #0x28]
    0x102a82224 <+184>: str    x15, [x19, #0x30]
    0x102a82228 <+188>: str    x16, [x19, #0x38]
    0x102a8222c <+192>: str    x17, [x19, #0x40]
    0x102a82230 <+196>: bl     0x102a82588              ; symbol stub for: printf
    0x102a82234 <+200>: mov    w10, #0x0
    0x102a82238 <+204>: mov    x0, x10
    0x102a8223c <+208>: ldp    x29, x30, [sp, #0x90]
    0x102a82240 <+212>: ldp    x20, x19, [sp, #0x80]
    0x102a82244 <+216>: add    sp, sp, #0xa0             ; =0xa0 
    0x102a82248 <+220>: ret    
å¤åˆ¶ä»£ç 
```

*   æˆ‘ä»¬ä¸»è¦åˆ†æä¸‹ `getStruct`å‡½æ•°~

![5.png](https://upload-images.jianshu.io/upload_images/19704571-f79782c83a14c795.image?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

> **çœ‹æ¥`ç»“æ„ä½“çš„è¿”å›å€¼`ï¼Œæ˜¯æå‰`é¢„ç•™`äº†ä¸€å—ç©ºé—´ï¼Œæ¥å­˜çš„ï¼Œå‚æ•°å¤šäº†ï¼Œé¢„ç•™ç©ºé—´ä¸ä¼šæœ‰å½±å“ï¼Œä½†æ˜¯`ä¼ å€¼`çš„æ—¶å€™ï¼Œè¿˜æ˜¯éœ€è¦`å…¥æ ˆ`æ“ä½œ**

> æœç„¶å•Šã€‚`LLVM`å¥½ç”Ÿå¼ºå¤§~ï¼ˆæˆ‘ä»¥åè¦ç ”ç©¶ä¸€ä¸‹~ï¼‰

## 3\. å‡½æ•°çš„å±€éƒ¨å˜é‡

*   `å±€éƒ¨å˜é‡`åº”è¯¥å°±å¥½çœ‹å¤šäº†ï¼ˆä¸»è¦æ˜¯`æ±‡ç¼–ä»£ç `ä¸ä¼šé‚£ä¹ˆå¤š~ï¼‰

*   ä¸Šä»£ç ~

```
int sumTest(int a, int b){
    int c = 5;
    return a+b+c;
}
int main(int argc, char * argv[]) {
    int d = sumTest(10,20);
    printf("%d\n",d);
}
å¤åˆ¶ä»£ç 
```

> å˜¿å˜¿~ï¼Œç ”ç©¶é—®é¢˜çš„æ—¶å€™å°±æ˜¯è¿™æ ·ï¼Œè‡ªå·±ä¸ä¼šå†™ï¼Œæ²¡æœ‰å…³ç³»ï¼Œçœ‹çœ‹ç³»ç»Ÿçº§åˆ«çš„æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œè®©ä»–ä»¬ç»™å’±ä»¬ä¸€ä¸ªæ€è·¯~

*   æˆ‘å°±ç›´æ¥çœ‹`sumTest`å‡½æ•°äº†

![6.png](https://upload-images.jianshu.io/upload_images/19704571-fb4480a852ef7a40.image?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

> çœ‹æ¥ä¸´æ—¶å˜é‡ä¹Ÿä¸èƒ½è¢«`x0-x7`å® å¹¸å•Š~

## 4\. å‡½æ•°çš„åµŒå¥—ä½¿ç”¨

*   ä¸Šé¢å‡½æ•°å·²ç»ç†è§£çš„å·®ä¸å¤šäº†~ã€‚ä½†æ˜¯ï¼Œ`å‡½æ•°è°ƒç”¨æ ˆ`â€”â€”æˆ‘ä»¬æœ€åæ¥æ„Ÿå—ä¸€æ³¢ï¼Œ`åµŒå¥—`è°ƒç”¨å§~ï¼ˆå½“ç„¶ä¸èƒ½æ­»å¾ªç¯å•Šã€‚ğŸ˜†ï¼‰

*   ç›´æ¥æ¥ä¸ªç®€å•çš„ä»£ç  (è¿™ä¸ªå°±å·¨ç®€å•çš„é‚£ç§~ï¼ˆå¦å¤–è¿˜æœ‰`å‡½æ•°çš„å‚æ•°åµŒå¥—ä¼ é€’`ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±è¯•è¯•ï¼‰)

```
void xgNestedTest2(){
    printf("666");
}

void xgNestedTest(){
    xgNestedTest2();
}

int main(int argc, char * argv[]) {
    xgNestedTest();
}
å¤åˆ¶ä»£ç 
```

![7.png](https://upload-images.jianshu.io/upload_images/19704571-9d0b27ee92d77831.image?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ä½œè€…ï¼šå°è°·å…ˆæ£®
é“¾æ¥ï¼šhttps://juejin.cn/post/6943494136246829069/
